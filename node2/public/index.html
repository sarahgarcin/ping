<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Test node</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="title">
    <img src="ping.png"></img>

</div>

<div style="float:left;width:100px;border-right:1px solid black;height:300px;padding:10px;overflow:scroll-y;">
    <b>Users</b>
    <div id="users">
        <p id="user"></p>
    </div>
</div>  
<textarea name="" id="pad_perso" cols="30" rows="10" style="width:400px; height:400px;"></textarea>
<div id="visualisateur" style="float:right;"> <textarea id="visu" style="width:300px; height:200px; margin-right:400px; "></textarea></div>

 <script src="/js/jquery-1.11.0.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>


<script>
$(document).ready(function(){

    keyEvent();
    rechremp();

    var socket = io.connect('http://localhost:8333');

    var user = prompt('Quel est votre pseudo ?');
            socket.emit('nouveau_client', user);
            document.title = user + ' - ' + document.title;


    var userList = [];

    socket.on('update', function (users){
        userList = users;
        $('#user').empty();
        for(var i=0; i<userList.length; i++) {
            $('#user').append("<h1>" + userList[i] + "</h1>"); 
        }
    });


    $( "#pad_perso").keyup(function() {
        socket.send(JSON.stringify($('#pad_perso').val()));
      });
            

    socket.on('message', function (data) {
       $('#visu').val(JSON.parse(data));
        var textArea = $('#visu');
        textArea.scrollTop(textArea[0].scrollHeight - textArea.height());

    });

});

function keyEvent() {
                        
    var chrono = 0;
    var typingTimer;                //timer identifier
    var doneTypingInterval = 10000;  //time in ms, 5 second for example  

    chrono = setInterval(function () {
        var currentVal = $('#pad_perso').val();
        $('#pad_perso').val(currentVal + '|\n');
    }, 10000);

    $('#pad_perso').keydown(function(event){
            // console.log('You pressed a key');
            clearInterval(chrono);
            clearTimeout(typingTimer);          
    });

    $('#pad_perso').keyup(function(){
        clearTimeout(typingTimer);
        typingTimer = setTimeout(doneTyping, doneTypingInterval);
    });

    function doneTyping () {
    chrono = setInterval(function () {
        var currentVal = $('#pad_perso').val();
        $('#pad_perso').val(currentVal + '|\n');
    }, 10000);
    }

}

function rechremp() {

    $('#pad_perso').keyup(function(event){
        var oldtxt = $(this).val();
        var regex = /\bbcp\b /ig;
        var newtxt = oldtxt.replace(regex, 'beaucoup ');
        $(this).val(newtxt);
        
        var oldtxt1 = $(this).val();
        var regex1 = /\bns\b /ig;
        var newtxt1 = oldtxt1.replace(regex1, 'nous ');
        $(this).val(newtxt1);

        var oldtxt2 = $(this).val();
        var regex2 = /\bvs\b /ig;
        var newtxt2 = oldtxt2.replace(regex2, 'vous ');
        $(this).val(newtxt2);

        var oldtxt3 = $(this).val();
        var regex3 = /\bpr\b /ig;
        var newtxt3 = oldtxt3.replace(regex3, 'pour ');
        $(this).val(newtxt3);

        var oldtxt4 = $(this).val();
        var regex4 = /\btt\b /ig;
        var newtxt4 = oldtxt4.replace(regex4, 'tout ');
        $(this).val(newtxt4);

        var oldtxt5 = $(this).val();
        var regex5 = /\btjs\b /ig;
        var newtxt5 = oldtxt5.replace(regex5, 'toujours ');
        $(this).val(newtxt5);

        var oldtxt6 = $(this).val();
        var regex6 = /\bpq\b /ig;
        var newtxt6 = oldtxt6.replace(regex6, 'pourquoi ');
        $(this).val(newtxt6);

        var oldtxt7 = $(this).val();
        var regex7 = /\bavt\b /ig;
        var newtxt7 = oldtxt7.replace(regex7, 'avant ');
        $(this).val(newtxt7);

    });


}

</script>


  
</body>
</html>

